"use strict";angular.module("clientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.tree","ngFileUpload"]),angular.module("clientApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"ctrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"ctrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl",controllerAs:"ctrl"}).when("/browser",{templateUrl:"views/fileBrowser.html",controller:"BrowserCtrl",controllerAs:"ctrl"}).when("/404",{templateUrl:"404.html"})}]),angular.module("clientApp").controller("LoginCtrl",["$scope","$rootScope","$compile","$http","$location","$cookies","userFactory","authFactory",function(a,b,c,d,e,f,g,h){function i(){if(void 0===j.username||null===j.username||""===j.username)return console.log("Invalid username"),void(j.invalid=!0);if(void 0===j.password||null===j.password||""===j.password)return console.log("Invalid password"),void(j.invalid=!0);var a={username:j.username,password:j.password};h.login(a,function(a){a===!0?(console.log("Login successful"),e.path("/browser")):(console.log("Login error"),j.invalid=!0,Materialize.toast(":( There was an error in login...please try again!",4e3))})}var j=this;j.username="",j.password="",j.invalid=!1,j.login=i}]),angular.module("clientApp").controller("SignupCtrl",["$scope","$rootScope","$compile","$http","$location","authFactory",function(a,b,c,d,e,f){function g(){if(""===h.username||void 0===h.username||null===h.username)return console.log("Invalid username"),void(h.invalid=!0);if(""===h.password||void 0===h.password||null===h.password)return console.log("Invalid password"),void(h.invalid=!0);if(h.confPassword!==h.password)return console.log("Password doesn't match"),void(h.invalid=!0);var a={username:h.username,password:h.password};f.signup(a,function(a){a===!0?(Materialize.toast("Welcome "+h.username+", perform the access to login the page!",4e3),e.path("/")):(console.log("Signup Error"),Materialize.toast(":( There was an error in signup...please try again!",4e3),e.path("/"))})}var h=this;h.username="",h.password="",h.confPassword="",h.invalid=!1,h.signUp=g}]),angular.module("clientApp").controller("MainCtrl",["$scope","$rootScope","$compile","$http","$location","authFactory",function(a,b,c,d,e,f){function g(a){e.path(a)}function h(){f.logout(),g("/")}var i=this;i.redirectTo=g,i.logout=h}]),angular.module("clientApp").controller("BrowserCtrl",["$scope","$rootScope","$compile","$http","$location","$cookies","userFactory","backendFactory","Upload",function(a,b,c,d,e,f,g,h,i){function j(a){if(null===a||""===a||void 0===a){var a=JSON.parse(f.get("userCookie")).username;console.log(a),null===a||""===a||void 0===a?e.path("/"):g.setUsername(a)}u=a;var b={username:a};d.post("http://"+h.getIpAddress()+":"+h.getPort()+h.getApiDirectory(),b).then(function(a){"ERROR_CONNECTION"===a.data.type&&(console.log("Error in connection"),e.path("/500")),s.categories=a.data,console.log(s.categories)})["catch"](function(a){console.log(a),e.path("/500")})}function k(a){t.innerHTML=a}function l(a,b){3===a.which&&(console.log("TASTO DESTRO"),u=b.path,v=b,t.innerHTML=u,console.log(u)),1===a.which&&(console.log("TASTO SINISTRO"),u=b.path,v=b,t.innerHTML=u,console.log(u))}function m(a){var b={user:g.getUsername(),guid:a.guid,path:a.path};d.post("http://"+h.getIpAddress()+":"+h.getPort()+h.getApiFile(),b).then(function(b){console.log(a),s.fileTitle=a.name,s.fileText=b.data})["catch"](function(a){console.log(a),e.path("/404")})}function n(a){var b=a.files[0];i.upload({url:"http://"+h.getIpAddress()+":"+h.getPort()+h.getApiUpload(),data:{file:b,username:g.getUsername(),path:u+"/"+b.name}}).then(function(a){console.log(a),console.log("Upload success!"),200===a.status?(Materialize.toast("Upload Completed",4e3),j(g.getUsername())):Materialize.toast(":( An error was occurred in file upload",4e3)})}function o(){var a={idUser:g.getUsername(),path:u};d.post("http://"+h.getIpAddress()+":"+h.getPort()+h.getApiDelete(),a).then(function(a){"DELETE_SUCCESS"===a.data.type?(Materialize.toast("Delete Completed",4e3),s.fileTitle="",s.fileText="",j(g.getUsername())):Materialize.toast(":( An error was occurred in file delete",4e3)})["catch"](function(a){console.log(a)})}function p(){s.newFolder=!0}function q(){s.newFolder=!1}function r(a){if(13===a.which||13===a.keyCode){var b={folder:!0,path:u+"/"+s.newFolderName,name:s.newFolderName,children:[]};v.children.push(b),q()}}var s=this,t=document.getElementById("path"),u="",v=null;s.addNavbar=k,s.openFile=m,s.handleClick=l,s["delete"]=o,s.openInput=p,s.closeInput=q,s.createFolder=r,s.fileName="",s.fileTitle="",s.fileText="",s.newFolder=!1,s.newFolderName="",a.uploadFile=n,j(g.getUsername())}]),angular.module("clientApp").directive("context",[function(){return{restrict:"A",scope:"@&",compile:function(a,b,c){return{post:function(a,b,c,d){var e=$("#"+c.context),f=null;e.css({display:"none"}),$(b).bind("contextmenu",function(a){a.preventDefault(),e.css({position:"fixed",display:"block",left:a.clientX+"px",top:a.clientY+"px"}),f=a.timeStamp}),$(document).click(function(a){var b=$(a.target);if(!b.is(".popover")&&!b.parents().is(".popover")){if(f===a.timeStamp)return;e.css({display:"none"})}})}}}}}]),angular.module("clientApp").factory("userFactory",function(){function a(a){null!==a&&""!==a||void 0!==a?c.username=a:console.log("Bad username")}function b(){return c.username}var c={};return c.username=null,c.setUsername=a,c.getUsername=b,c}),angular.module("clientApp").factory("authFactory",["$cookies","$http","userFactory","backendFactory",function(a,b,c,d){function e(e,f){b.post("http://"+d.getIpAddress()+":"+d.getPort()+d.getApiLogin(),e).then(function(b){if("LOGIN_SUCCESS"===b.data.type){var d=(a.get("userCookie"),{username:e.username});a.putObject("userCookie",d),c.setUsername(e.username),f(!0)}else f(!1)})["catch"](function(a){console.log(a),f(!1)})}function f(){a.remove("userCookie"),c.setUsername(null)}function g(a,c){b.post("http://"+d.getIpAddress()+":"+d.getPort()+d.getApiRegistration(),a).then(function(a){c("REGISTRATION_SUCCESS"===a.data.type?!0:!1)})["catch"](function(a){console.log(a),c(!1)})}var h={};return h.login=e,h.logout=f,h.signup=g,h}]),angular.module("clientApp").factory("backendFactory",["APP_CONFIGURATION",function(a){function b(){return j.ipAddress}function c(){return j.port}function d(){return j.getDirectory}function e(){return j.getFile}function f(){return j.uploadFile}function g(){return j.deleteFile}function h(){return j.login}function i(){return j.registration}var j={};return j.ipAddress=a.backendAddress,j.port=a.backendPort,j.getDirectory=a.getDirectory,j.getFile=a.getFile,j.uploadFile=a.uploadFile,j.deleteFile=a.deleteFile,j.login=a.login,j.registration=a.registration,j.getIpAddress=b,j.getPort=c,j.getApiDirectory=d,j.getApiFile=e,j.getApiUpload=f,j.getApiDelete=g,j.getApiLogin=h,j.getApiRegistration=i,j}]),angular.module("clientApp").constant("APP_CONFIGURATION",{backendAddress:"54.208.204.184",backendPort:"9001",getDirectory:"/api/backend/getDirectory",getFile:"/api/backend/getFile",uploadFile:"/api/backend/uploadFile",deleteFile:"/api/backend/deleteFile",login:"/api/backend/login",registration:"/api/backend/registration"}),angular.module("clientApp").run(["$templateCache",function(a){a.put("views/fileBrowser.html",'<header oncontextmenu="return false"> <div class="navbar-fixed" style="z-index: 9999" ng-controller="MainCtrl as ctrl"> <nav id="navbar" class="nav-wrapper indigo"> <div class="col s12"> <ul class="left hide-on-med-and-down"> <li> <p id="path" style="margin-left: 10px"></p> </li> </ul> <ul class="right hide-on-med-and-down"> <li> <button id="logout" class="btn amber darken-2 waves-effect" ng-click="ctrl.logout();" style="outline: 0; margin-right: 10px">Logout</button> </li> </ul> </div> </nav> </div> <div class="side-nav fixed"> <div ui-tree="" class="angular-ui-tree" data-nodrop-enabled="true" data-clone-enabled="false" style="top: 50%;\n      left: 50%;\n      margin-top: 30%;\n      margin-left: 10px;\n      width: 100px;\n      height: 100px"> <script type="text/ng-template" id="categories.html"><div ui-tree-handle class="tree-node tree-node-content angular-ui-tree-handle" data-nodrag>\n            <div context="context1" class="collapsible-header" ng-click="toggle(this);" ng-mousedown="ctrl.handleClick($event, cat)"\n                 style="margin-top: 10px; font-weight: 200; min-width: 250%">\n              <a class="" data-nodrag\n                  ng-if="cat.children && !cat.newFolder">\n                                            <span class="glyphicon"\n                                                  ng-class="{\'glyphicon-folder-close\': !collapsed,\'glyphicon-folder-open\': collapsed}"\n                                                  style="margin-right: 10px;">\n                                            </span>\n              </a>\n              <a class="" data-nodrag\n                 ng-if="!cat.children" ng-dblclick="ctrl.openFile(cat)">\n                                            <span class="glyphicon glyphicon-file" style="margin-right: 10px;">\n                                            </span>\n              </a>\n              {{cat.name}}\n            </div>\n        </div>\n          <ol ui-tree-nodes="" ng-model="ctrl.categories" ng-if="cat.children" ng-class="{hidden: !collapsed}">\n            <li ng-repeat="cat in cat.children"\n                ui-tree-node ng-include="\'categories.html\'" style="min-width: 100px">\n            </li>\n          </ol>\n        </div></script> <ol ui-tree-nodes="" ng-model="ctrl.categories" ng-class="{hidden: collapsed}"> <li ng-repeat="cat in ctrl.categories" ui-tree-node ng-include="\'categories.html\'" style="min-width: 100px"></li> </ol> </div> <input style="margin-top: 150%; margin-left: 5%; max-width: 90%" ng-if="ctrl.newFolder" ng-model="ctrl.newFolderName" ng-keypress="ctrl.createFolder($event)"> </div> </header> <main> <div id="fileContent" class="container"> <div class="row"> <div class="col s12 m9 l10 offset-l1"> <div class="section"> <h4 id="fileTitle">{{ctrl.fileTitle}}</h4> <p id="fileText">{{ctrl.fileText}}</p> </div> </div> </div> </div> </main> <ul id="context1" class="dropdown-menu" style="z-index: 10000"> <div class="image-upload dropdown-header"> <label for="file-input"> <li style="display: block; font-weight: normal; font-size: small; color: #333; line-height: 1.42857143">New File</li> </label> <input id="file-input" type="file" onchange="angular.element(this).scope().uploadFile(this)"> </div> <li><a ng-click="ctrl.openInput()">New Folder</a></li> <li><a ng-click="ctrl.delete()">Delete</a></li> <li class="divider"></li> <li><a ng-click="">Properties</a></li> </ul> <!--\n<form id="form">\n  <div class="image-upload" style="position: fixed; bottom: 20px; right: 20px;">\n    <label for="file-input">\n      <div class="btn-floating btn-large waves-effect waves-light indigo">\n        <i class="glyphicon glyphicon-cloud-upload"></i>\n      </div>\n    </label>\n    <input id="file-input" type="file" onchange="angular.element(this).scope().uploadFile(this);"/>\n  </div>\n</form>\n-->'),a.put("views/login.html",'<section class="z-depth-1" style="position: relative"> <canvas class="indigo darken-2" style="width: 100%; height: 100%"></canvas> <div class="container center-align" style="position: absolute; top: 10%; left: 22%"> <div class="row"> <div class="col s12"> <h5 class="white-text" style="font-family: &quot;Roboto&quot;, sans-serif; font-weight: 200">Sign-in to Storage </h5> </div> </div> <form class="col s12"> <div class="row"> <div class="input-field col s6 offset-l3"> <input id="username" type="text" class="validate" ng-model="ctrl.username"> <label for="username" class="white-text">Username</label> </div> </div> <div class="row"> <div class="input-field col s6 offset-l3"> <input id="password" type="password" class="validate" ng-model="ctrl.password"> <label for="password" class="white-text">Password</label> </div> </div> <div class="row"> <div class="input-field col s12"> <button class="btn btn-large amber darken-2 waves-effect" ng-click="ctrl.login()" style="outline: 0">Sign-in</button> </div> </div> </form> </div> </section> <footer id="footer" class="page-footer white" style="position:fixed;left:0px;bottom:0px;width:100%"> <div class="footer-copyright white"> <div class="container center-align"> <p class="black-text">Application developed by: <strong>C.La Riccia - D.Partigianoni - S.Grippo</strong></p> </div> </div> </footer>'),a.put("views/main.html",'<div class="navbar-fixed" style="z-index: 9999" ng-controller="MainCtrl as ctrl"> <nav id="navbar" class="nav-wrapper white"> <div class="col s12"> <a href="/" class="brand-logo"> <p id="logo" class="indigo-text darken-2" style="font-family: &quot;Roboto&quot;, sans-serif; font-weight: 400; margin-left: 10px">Logo</p> </a> <ul class="right hide-on-med-and-down"> <li> <a id="signup" class="indigo-text darken-2" ng-click="ctrl.redirectTo(\'/signup\');" style="margin-right: 10px">Sign-up</a> </li> <li> <button id="login" class="btn amber darken-2 waves-effect" ng-click="ctrl.redirectTo(\'/login\');" style="outline: 0; margin-right: 10px">Sign-in</button> </li> </ul> </div> </nav> </div> <section class="z-depth-1" style="position: relative"> <canvas class="indigo darken-2" style="width: 100%; height: 100%"></canvas> <div class="container center-align" style="position: absolute; top: 20%; left: 22%"> <div class="row"> <div class="col s12"> <h3 class="white-text" style="font-family: &quot;Roboto&quot;, sans-serif; font-weight: 200">Storage Application</h3> <h5 class="white-text" style="font-family: &quot;Roboto&quot;, sans-serif; font-weight: 200">A distributed app to manage file. Scalable. Elastic. </h5> </div> </div> </div> </section> <footer id="footer" class="page-footer white" style="position:fixed;left:0px;bottom:0px;width:100%"> <div class="footer-copyright white"> <div class="container center-align"> <p class="black-text">Application developed by: <strong>C.La Riccia - D.Partigianoni - S.Grippo</strong></p> </div> </div> </footer>'),a.put("views/signup.html",'<section class="z-depth-1" style="position: relative"> <canvas class="indigo darken-2" style="width: 100%; height: 100%"></canvas> <div class="container center-align" style="position: absolute; top: 10%; left: 22%"> <div class="row"> <div class="col s12"> <h5 class="white-text" style="font-family: &quot;Roboto&quot;, sans-serif; font-weight: 200">Sign-up to Storage </h5> </div> </div> <form class="col s12"> <div class="row"> <div class="input-field col s6 offset-l3"> <input id="username" type="text" class="validate" ng-model="ctrl.username"> <label for="username" class="white-text">Username</label> </div> </div> <div class="row"> <div class="input-field col s3 offset-l3"> <input id="password" type="password" class="validate" ng-model="ctrl.password"> <label for="password" class="white-text">Password</label> </div> <div class="input-field col s3"> <input id="confPassword" type="password" class="validate" ng-model="ctrl.confPassword"> <label for="confPassword" class="white-text">Confirm Password</label> </div> </div> <div class="row"> <div class="input-field col s12"> <button class="btn btn-large amber darken-2 waves-effect" ng-click="ctrl.signUp()" style="outline: 0">Sign-up</button> </div> </div> </form> </div> </section> <footer id="footer" class="page-footer white" style="position:fixed;left:0px;bottom:0px;width:100%"> <div class="footer-copyright white"> <div class="container center-align"> <p class="black-text">Application developed by: <strong>C.La Riccia - D.Partigianoni - S.Grippo</strong></p> </div> </div> </footer>')}]);